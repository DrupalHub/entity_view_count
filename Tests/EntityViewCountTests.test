<?php

/**
 * @file
 * Contains simple test for entity view count module.
 */

class EntityViewCountTests extends DrupalWebTestCase {

  /**
   * @var \stdClass
   *
   * The node object.
   */
  protected $node;

  /**
   * @var
   *
   * The user object.
   */
  protected $user;

  public static function getInfo() {
    return array(
      'name' => 'Entity view count.',
      'description' => 'Testing the basic functionality of the entity view count module.',
      'group' => 'Entity view count',
    );
  }

  /**
   * Overrides parent::setUp().
   */
  public function setUp() {
    parent::setUp(array('entity_view_count'));

    $this->user = $this->drupalCreateUser();

    $contentType = $this->drupalCreateContentType();
    $this->node = $this->drupalCreateNode(array('type' => $contentType->type, 'uid' => $this->user->uid));
  }

  /**
   * Visit the node a defined number of times.
   *
   * @param $times
   *  The number of times.
   */
  private function visitNumberOfTimes($times) {
    for ($i = 0; $i < $times; $i++) {
      $this->drupalGet('node/' . $this->node->nid);
    }
  }


  /**
   * Verifying the number of times that a node was viewed and the number of
   * times the users entity was viewed. They both need to be 5.
   */
  public function testEntityViewCount() {
    // Visit the the node multiple times by a guest.
    $this->visitNumberOfTimes(5);

    $this->assertTrue(entity_view_count_get_entity_counts('node', $this->node->nid) == 5, 'The node was viewed 5 times.');
    $this->assertTrue(entity_view_count_get_entity_counts('node', $this->node->nid) == 5, 'The user\'s viewed 5 times.');
  }
}